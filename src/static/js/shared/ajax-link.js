// Generated by CoffeeScript 1.6.2
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

define(['jquery'], function($) {
  var AjaxLink;

  return AjaxLink = (function() {
    function AjaxLink(url, options) {
      var defaultView, nullView,
        _this = this;

      this.url = url;
      this._complete = __bind(this._complete, this);
      this._success = __bind(this._success, this);
      this.post = __bind(this.post, this);
      this.get = __bind(this.get, this);
      nullView = {
        setFromJSON: function(json) {}
      };
      defaultView = {
        setFromJSON: function(json) {
          if (json) {
            return alert("" + json.type + ": " + json.message);
          }
        }
      };
      this.getView = options.getView || nullView;
      this.postView = options.postView || defaultView;
      this.putView = options.putView || defaultView;
      this.deleteView = options.deleteView || defaultView;
    }

    AjaxLink.prototype.get = function(id, dataCallback) {
      var _this = this;

      return $.ajax({
        url: this.url,
        type: 'GET',
        success: function(data) {
          return _this._success(_this.getView, dataCallback)(data);
        },
        complete: function(xhr, status) {
          return _this._complete(_this.getView)(xhr, status);
        }
      });
    };

    AjaxLink.prototype.post = function(data, dataCallback) {
      var _this = this;

      return $.ajax({
        url: this.url,
        type: 'POST',
        data: JSON.stringify(data),
        success: function(data) {
          return _this._success(_this.postView, dataCallback)(data);
        },
        complete: function(xhr, status) {
          return _this._complete(_this.postView)(xhr, status);
        }
      });
    };

    AjaxLink.prototype._success = function(view, dataCallback) {
      var _this = this;

      return function(data) {
        var response;

        response = JSON.parse(data);
        view.setFromJSON(response.status);
        if (response.data) {
          return dataCallback(response.data);
        }
      };
    };

    AjaxLink.prototype._complete = function(view) {
      var _this = this;

      return function(xhr, status) {
        if (status !== 'success') {
          return view.setFromJSON({
            type: xhr.status,
            message: xhr.statusText
          });
        }
      };
    };

    return AjaxLink;

  })();
});
